<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Fits Linear Mixed-Effect model via Study-Level Meta-Analysis</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../../assets/R.css" />
</head><body>

<table width="100%" summary="page for ds.lmerSLMA {dsBaseClient}"><tr><td>ds.lmerSLMA {dsBaseClient}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Fits Linear Mixed-Effect model via Study-Level Meta-Analysis</h2>

<h3>Description</h3>

<p><code>ds.lmerSLMA</code> fits a Linear Mixed-Effects Model (lme) - can include both
fixed and random-effects - on data from one or multiple sources with pooling via SLMA
(Study-Level Meta-Analysis)
</p>


<h3>Usage</h3>

<pre>
ds.lmerSLMA(
  formula = NULL,
  offset = NULL,
  weights = NULL,
  combine.with.metafor = TRUE,
  dataName = NULL,
  checks = FALSE,
  datasources = NULL,
  REML = TRUE,
  control_type = NULL,
  control_value = NULL,
  optimizer = NULL,
  verbose = 0,
  notify.of.progress = FALSE,
  assign = FALSE,
  newobj = NULL
)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>formula</code></td>
<td>
<p>an object of class formula describing the model to be fitted. 
For more information see <strong>Details</strong>.</p>
</td></tr>
<tr valign="top"><td><code>offset</code></td>
<td>
<p>a character string specifying the name of a variable to be used as
an offset.</p>
</td></tr>
<tr valign="top"><td><code>weights</code></td>
<td>
<p>a character string specifying the name of a variable containing
prior regression weights for the fitting process.</p>
</td></tr>
<tr valign="top"><td><code>combine.with.metafor</code></td>
<td>
<p>logical. If TRUE the
estimates and standard errors for each regression coefficient are pooled across
studies using random-effects meta-analysis under maximum likelihood (ML),
restricted maximum likelihood (REML) or fixed-effects meta-analysis (FE). Default TRUE.</p>
</td></tr>
<tr valign="top"><td><code>dataName</code></td>
<td>
<p>a character string specifying the name of an (optional) data frame
that contains all of the variables in the LME formula. 
For more information see <strong>Details</strong>.</p>
</td></tr>
<tr valign="top"><td><code>checks</code></td>
<td>
<p>logical. If TRUE <code>ds.lmerSLMA</code> checks the structural integrity 
of the model. Default FALSE. For more information see <strong>Details</strong>.</p>
</td></tr>
<tr valign="top"><td><code>datasources</code></td>
<td>
<p>a list of <code>DSConnection-class</code> objects obtained after login. 
If the <code>datasources</code> argument is not specified
the default set of connections will be used: see <code>datashield.connections_default</code>.</p>
</td></tr>
<tr valign="top"><td><code>REML</code></td>
<td>
<p>logical. If TRUE the REstricted Maximum Likelihood (REML)
is used for parameter optimization. 
If FALSE the parameters are optimized using standard ML (maximum likelihood). Default TRUE. 
For more information see <strong>Details</strong>.</p>
</td></tr>
<tr valign="top"><td><code>control_type</code></td>
<td>
<p>an optional character string vector specifying the nature of a parameter
(or parameters) to be modified in the <code>convergence control options</code> which can be viewed or
modified via the <code>lmerControl</code> function of the package <code>lme4</code>. 
For more information see <strong>Details</strong>.</p>
</td></tr>
<tr valign="top"><td><code>control_value</code></td>
<td>
<p>numeric representing the new value which you want to allocate the
control parameter corresponding to the <code>control-type</code>. 
For more information see <strong>Details</strong>.</p>
</td></tr>
<tr valign="top"><td><code>optimizer</code></td>
<td>
<p>specifies the parameter optimizer that <code>lmer</code> should use.
For more information see <strong>Details</strong>.</p>
</td></tr>
<tr valign="top"><td><code>verbose</code></td>
<td>
<p>an integer value. If <i>verbose &gt; 0</i> the output is generated during the optimization of
the parameter estimates. If <i>verbose &gt; 1</i> the output is generated during the individual penalized 
iteratively reweighted least squares (PIRLS) steps. Default <code>verbose</code> 
value is 0 which means no additional output.</p>
</td></tr>
<tr valign="top"><td><code>notify.of.progress</code></td>
<td>
<p>specifies if console output should be produced to indicate
progress. Default FALSE.</p>
</td></tr>
<tr valign="top"><td><code>assign</code></td>
<td>
<p>a logical, indicates whether the function will call a second server-side function
(an assign) in order to save the regression outcomes (i.e. a lmerMod object) on each server.
Default FALSE.</p>
</td></tr>
<tr valign="top"><td><code>newobj</code></td>
<td>
<p>a character string specifying the name of the object to which the lmerMod object
representing the model fit on the serverside in each study is to be written. This argument is 
used only when the argument <code>assign</code> is set to TRUE.
If no &lt;newobj&gt; argument is specified, the output object defaults to &quot;new.lmer.obj&quot;.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><code>ds.lmerSLMA</code> fits a Linear Mixed Effects Model (lme) - can include both fixed and random
effects - on data from single or multiple sources.
</p>
<p>This function is similar to <code>lmer</code> function from <code>lme4</code> package in native R.
</p>
<p>When there are multiple data sources,
the LME is fitted to convergence in each data source independently. The
estimates and standard errors returned to the client-side which enable cross-study pooling
using Study-Level Meta-Analysis (SLMA).  The SLMA used by default <code>metafor</code> package  
but as the SLMA occurs on the client-side (a standard R environment), the user can choose 
any approach to meta-analysis.  Additional information about fitting 
LMEs using the <code>lmer</code> function can be 
obtained using R help for <code>lmer</code> and the <code>lme4</code> package.
</p>
<p>In <code>formula</code> most shortcut notation allowed by  <code>lmer()</code> function is
also allowed by <code>ds.lmerSLMA</code>. Many LMEs can be fitted very simply using a formula like:
</p>
<p style="text-align: center;"><i>y~a+b+(1|c)</i></p>

<p>which simply means fit an LME with <code>y</code> as the outcome variable with <code>a</code> and <code>b</code>
as fixed effects, and <code>c</code> as a random effect or grouping factor.
</p>
<p>It is also possible to fit models with random slopes by specifying a model such as 
</p>
<p style="text-align: center;"><i>y~a+b+(1+b|c)</i></p>
 
<p>where the effect of <code>b</code> can vary randomly between groups defined by <code>c</code>.
Implicit nesting can be specified with formulae such as <i>y~a+b+(1|c/d)</i>
or <i>y~a+b+(1|c)+(1|c:d)</i>. 
</p>
<p>The <code>dataName</code> argument avoids you having to specify the name of the
data frame in front of each covariate in the formula. 
For example, if the data frame is called <code>DataFrame</code> you avoid having to write: 
<i>DataFrame$y~DataFrame$a+DataFrame$b+(1|DataFrame$c)</i>.
</p>
<p>The <code>checks</code> argument verifies that the variables in the model are all defined (exist) 
on the server-site at every study
and that they have the correct characteristics required to fit the model. 
It is suggested to make <code>checks</code> argument TRUE if an unexplained
problem in the model fit is encountered because the running process takes several minutes.
</p>
<p><code>REML</code> can help to mitigate
bias associated with the fixed-effects. See help on the <code>lmer()</code> function for more details.
</p>
<p>In <code>control_type</code> at present only one such parameter can be modified,
namely the tolerance of the convergence criterion to the gradient of the log-likelihood 
at the maximum likelihood achieved. We have enabled this because our practical experience
suggests that in situations where the model looks to have converged with sensible parameter
values but formal convergence is not being declared if we allow the model to be more
tolerant to a non-zero gradient the same parameter values are obtained but formal
convergence is declared. The default value for the <code>check.conv.grad</code> is <code>0.002</code>. 
</p>
<p><code>control_value</code> At present (see <code>control_type</code>)
the only parameter this can be is the convergence tolerance <code>check.conv.grad</code>. In
general, models will be identified as having converged more readily if the value set
for <code>check.conv.grad</code> is increased from its default (<code>0.002</code>).  Please note
that the risk of doing this is that the model is also more likely to be declared
as having converged at a local maximum that is not the global maximum likelihood.
This will not generally be a problem if the likelihood surface is well behaved but if
you have a problem with convergence you might usefully compare all the parameter
estimates and standard errors obtained using the default tolerance (<code>0.002</code>) even though
that has not formally converged with those obtained after convergence using the higher
tolerance. 
</p>
<p>The <code>optimizer</code> argument is built in but it won't do anything because there is only one
standard optimizer available for lmer - this is the <code>nloptwrap</code> optimizer. If users
wish to apply a different optimizer - potentially one they have developed themselves -
the development team can activate this argument so alternatives can be specified.
</p>
<p>Server function called: <code>lmerSLMADS2</code>
</p>


<h3>Value</h3>

<p>Many of the elements of the output list returned by <code>ds.lmerSLMA</code> are 
equivalent to those returned by the <code>lmer()</code> function in native R. However,
potentially disclosive elements
such as individual-level residuals and linear predictor values are blocked. 
In this case, only non-disclosive elements are returned from each study separately.
</p>
<p>The list of elements returned by <code>ds.lmerSLMA</code> is mentioned below:
</p>
<p><code>ds.lmerSLMA</code> returns a list of  elements mentioned 
below separately for each study.
</p>
<p><code>coefficients</code>: a matrix with 5 columns:
</p>

<ul>
<li><p>First: the names of all of the regression parameters (coefficients) in the model 
</p>
</li>
<li><p>second: the estimated values 
</p>
</li>
<li><p>third: corresponding standard errors of the estimated values 
</p>
</li>
<li><p>fourth: the ratio of estimate/standard error 
</p>
</li>
<li><p>fifth: the p-value treating that as a standardised normal deviate 
</p>
</li></ul>

<p><code>CorrMatrix</code>: the correlation matrix of parameter estimates.
</p>
<p><code>VarCovMatrix</code>: the variance-covariance matrix of parameter estimates.
</p>
<p><code>weights</code>: the vector (if any) holding regression weights.
</p>
<p><code>offset</code>: the vector (if any) holding an offset.
</p>
<p><code>cov.scaled</code>: equivalent to <code>VarCovMatrix</code>.
</p>
<p><code>Nmissing</code>: the number of missing observations in the given study.
</p>
<p><code>Nvalid</code>: the number of valid (non-missing) observations in the given study.
</p>
<p><code>Ntotal</code>: the total number of observations 
in the given study (<code>Nvalid</code> + <code>Nmissing</code>).
</p>
<p><code>data</code>: equivalent to input parameter <code>dataName</code> (above).
</p>
<p><code>call</code>: summary of key elements of the call to fit the model.
</p>
<p>There are a small number of more esoteric items of the information returned
by <code>ds.lmerSLMA</code>. Additional information about these can be found in the help
file for the <code>lmer()</code> function in the <code>lme4</code> package.
</p>
<p>Once the study-specific output has been returned, the function returns
several elements relating to the pooling of estimates across studies via
study-level meta-analysis. These are as follows:
</p>
<p><code>input.beta.matrix.for.SLMA</code>: a matrix containing the vector of coefficient
estimates from each study.
</p>
<p><code>input.se.matrix.for.SLMA</code>: a matrix containing the vector of standard error
estimates for coefficients from each study.
</p>
<p><code>SLMA.pooled.estimates</code>: a matrix containing pooled estimates for each
regression coefficient across all studies with pooling under SLMA via
random-effects meta-analysis under maximum likelihood (ML), restricted maximum
likelihood (REML) or via fixed-effects meta-analysis (FE).
</p>
<p><code>convergence.error.message</code>:  reports for each study whether the model converged.
If it did not some information about the reason for this is reported.
</p>


<h3>Author(s)</h3>

<p>DataSHIELD Development Team
</p>


<h3>Examples</h3>

<pre>
## Not run: 

 ## Version 6, for version 5 see Wiki
  # Connecting to the Opal servers
  
  require('DSI')
  require('DSOpal')
  require('dsBaseClient')
  
  builder &lt;- DSI::newDSLoginBuilder()
  builder$append(server = "study1", 
                 url = "http://192.168.56.100:8080/", 
                 user = "administrator", password = "datashield_test&amp;", 
                 table = "CLUSTER.CLUSTER_SLO1", driver = "OpalDriver")
  builder$append(server = "study2", 
                 url = "http://192.168.56.100:8080/", 
                 user = "administrator", password = "datashield_test&amp;", 
                 table = "CLUSTER.CLUSTER_SLO2", driver = "OpalDriver")
  builder$append(server = "study3",
                 url = "http://192.168.56.100:8080/", 
                 user = "administrator", password = "datashield_test&amp;", 
                 table = "CLUSTER.CLUSTER_SLO3", driver = "OpalDriver")
  logindata &lt;- builder$build()
  
   #Log onto the remote Opal training servers
   connections &lt;- DSI::datashield.login(logins = logindata, assign = TRUE, symbol = "D")
               
  # Select all rows without missing values
  ds.completeCases(x1 = "D", newobj = "D.comp", datasources = connections)
 
  # Fit the lmer
  
  ds.lmerSLMA(formula = "BMI ~  incid_rate + diabetes + (1 | Male)",
               dataName = "D.comp",
               datasources = connections)
  
  # Clear the Datashield R sessions and logout
  datashield.logout(connections) 
  
## End(Not run)
</pre>

<hr /><div style="text-align: center;">[Package <em>dsBaseClient</em> version 6.1.1 ]</div>
</body></html>
